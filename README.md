# 闲鱼监控机器人 (Goofish Monitor)

一个基于 **Playwright + FastAPI**
的闲鱼商品智能监控与采集系统，支持多任务调度、Web
管理界面、结果存储与查询，适合批量监控目标商品并进行后续数据分析。

------------------------------------------------------------------------

## 📂 项目结构

    .
    ├── src/
    │   ├── config.py           # 全局配置（登录状态文件路径、运行模式等）
    │   ├── spider/             # 页面解析逻辑
    │   │   ├── parsers.py      # 商品与卖家数据解析
    │   │   ├── spider.py       # 核心爬虫脚本，负责商品采集
    │   ├── task/
    │   │   ├── task.py         # 任务数据结构与管理
    │   │   ├── result.py       # 爬取结果存储与查询
    │   ├── server/
    │   │   ├── scheduler.py    # 任务调度与运行管理
    │   │   ├── server.py       # Web 服务入口，提供任务管理与结果接口
    │   ├── utils/
    │   │   ├── utils.py        # 工具函数 (sleep、数据获取安全封装等)
    ├── resources/
    │   └── static/             # 前端静态资源 (Web 管理界面)
    ├── tasks.json              # 任务配置文件
    ├── requirements.txt        # Python 依赖

------------------------------------------------------------------------

## ⚡ 快速开始

### 1. 环境准备

- Python 3.10+
- Google Chrome 或 Edge 浏览器
- Node.js（仅首次安装 Playwright 需要）

安装依赖：

``` bash
pip install -r requirements.txt
playwright install
```

### 2.构建前端资源
```bash
cd webui
npm run build
```


### 3. 启动服务

``` bash
python start.py
```

启动后访问：

    http://127.0.0.1:8000

登录后可在 Web 界面管理任务、启动/停止采集、查看数据。

------------------------------------------------------------------------

## 🔄 工作流程

1. **任务配置加载**
    - 从 `tasks.json` 读取启用的任务（或根据传参执行单任务）。
    - 每个任务包含关键词、页数、价格区间等筛选条件。
2. **爬虫执行**
    - 使用 Playwright
      打开搜索页，模拟用户筛选条件（最新、个人闲置、价格区间）。
    - 解析搜索结果，获取商品 ID 与链接。
    - 请求详情页，采集商品信息与卖家信息。
    - 自动检测反爬虫机制，如遇拦截会进入长时间休眠并退出。
3. **结果存储**
    - 每个任务的结果以 `jsonl` 格式保存，避免重复写入。
    - 提供基于关键词的结果查询与删除接口。
4. **Web 管理界面**
    - 登录认证基于 JWT。
    - 提供任务的增删改查、手动启动/停止、查看执行状态。
    - 结果支持分页查询与筛选。
